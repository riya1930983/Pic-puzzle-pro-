<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
</head>

<body>
  
</body>

</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Pic Puzzle Pro</title>
<meta name="theme-color" content="#5a9ffb" />
<style>
body {
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg, #50c9f2, #5a9ffb);
  display: flex;
  flex-direction: column;
  align-items: center;
  height: 100vh;
  padding: 20px;
  margin: 0;
}
h1 { color: white; font-weight: 900; margin-bottom: 10px; }
#puzzle {
  width: 300px; height: 300px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 2px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  margin-top: 10px;
}
.piece {
  border-radius: 6px;
  background-size: 300px 300px;
  cursor: pointer;
}
button, select {
  padding: 10px 20px;
  margin: 8px;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: bold;
  background: white;
  color: #2155cd;
  cursor: pointer;
}
#timer {
  color: white;
  font-size: 18px;
  font-weight: bold;
  margin: 10px;
}
.install-btn {
  display: none;
}
</style>
</head>
<body>
<h1>Pic Puzzle Pro</h1>

<input type="file" id="fileInput" accept="image/*" />

<select id="timeSelect">
  <option value="5">5 Seconds</option>
  <option value="10" selected>10 Seconds</option>
  <option value="15">15 Seconds</option>
  <option value="30">30 Seconds</option>
</select>

<div id="puzzle"></div>
<div id="timer">Time: 00:10</div>

<div>
  <button id="startBtn">Start</button>
  <button id="resetBtn">Reset</button>
</div>

<button id="installBtn" class="install-btn">ðŸ“² Install Game</button>

<script>
// ----- GAME LOGIC -----
const fileInput = document.getElementById('fileInput');
const puzzle = document.getElementById('puzzle');
const timerEl = document.getElementById('timer');
const startBtn = document.getElementById('startBtn');
const resetBtn = document.getElementById('resetBtn');
const installBtn = document.getElementById('installBtn');
const timeSelect = document.getElementById('timeSelect');

const PUZZLE_SIZE = 3;
let pieces = [], originalOrder = [], currentOrder = [];
let timer = null, secondsLeft = 10, isStarted = false, imageSrc = '';
let firstSelected = null;

function formatTime(sec) {
  return `${String(Math.floor(sec / 60)).padStart(2, '0')}:${String(sec % 60).padStart(2, '0')}`;
}

function createPuzzle(image) {
  puzzle.innerHTML = '';
  pieces = [];
  originalOrder = [];
  currentOrder = [];
  const size = 300 / PUZZLE_SIZE;
  for (let i = 0; i < 9; i++) {
    const div = document.createElement('div');
    div.className = 'piece';
    div.style.width = size + 'px';
    div.style.height = size + 'px';
    const r = Math.floor(i / 3), c = i % 3;
    div.style.backgroundImage = `url(${image})`;
    div.style.backgroundPosition = `-${c * size}px -${r * size}px`;
    div.dataset.index = i;
    pieces.push(div);
    originalOrder.push(i);
    currentOrder.push(i);

    div.onclick = () => {
      if (!isStarted) return;
      if (firstSelected === null) {
        firstSelected = i;
        div.style.filter = 'brightness(60%)';
      } else {
        if (i !== firstSelected) swapPieces(firstSelected, i);
        pieces[firstSelected].style.filter = 'brightness(100%)';
        firstSelected = null;
        if (checkWin()) {
          clearInterval(timer);
          alert('ðŸŽ‰ You Win! ðŸŽ¯');
          isStarted = false;
        }
      }
    };
    puzzle.appendChild(div);
  }
}

function swapPieces(a, b) {
  [currentOrder[a], currentOrder[b]] = [currentOrder[b], currentOrder[a]];
  const temp = pieces[a].style.backgroundPosition;
  pieces[a].style.backgroundPosition = pieces[b].style.backgroundPosition;
  pieces[b].style.backgroundPosition = temp;
}

function shufflePieces() {
  for (let i = currentOrder.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [currentOrder[i], currentOrder[j]] = [currentOrder[j], currentOrder[i]];
  }
  const size = 300 / PUZZLE_SIZE;
  pieces.forEach((p, i) => {
    const pos = currentOrder[i];
    const r = Math.floor(pos / 3), c = pos % 3;
    p.style.backgroundPosition = `-${c * size}px -${r * size}px`;
  });
}

function checkWin() {
  return currentOrder.every((v, i) => v === originalOrder[i]);
}

function startTimer() {
  secondsLeft = parseInt(timeSelect.value);
  timerEl.textContent = 'Time: ' + formatTime(secondsLeft);
  timer = setInterval(() => {
    secondsLeft--;
    timerEl.textContent = 'Time: ' + formatTime(secondsLeft);
    if (secondsLeft <= 0) {
      clearInterval(timer);
      alert('â° Time Over!');
      isStarted = false;
    }
  }, 1000);
}

function stopTimer() {
  clearInterval(timer);
  timer = null;
}

fileInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;
  const r = new FileReader();
  r.onload = ev => {
    imageSrc = ev.target.result;
    createPuzzle(imageSrc);
  };
  r.readAsDataURL(file);
  stopTimer();
  timerEl.textContent = 'Time: 00:10';
  isStarted = false;
};

startBtn.onclick = () => {
  if (!imageSrc) return alert('Select image first');
  if (isStarted) return;
  shufflePieces();
  startTimer();
  isStarted = true;
};

resetBtn.onclick = () => {
  if (!imageSrc) return;
  stopTimer();
  secondsLeft = parseInt(timeSelect.value);
  timerEl.textContent = 'Time: ' + formatTime(secondsLeft);
  createPuzzle(imageSrc);
  isStarted = false;
};

// ----- INSTALL BUTTON (PWA) -----
let deferredPrompt;
window.addEventListener('beforeinstallprompt', e => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'inline-block';
});
installBtn.addEventListener('click', async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;
    if (result.outcome === 'accepted') {
      installBtn.style.display = 'none';
    }
    deferredPrompt = null;
  }
});
</script>
</body>
</html>